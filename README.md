CaliPy - Camera Calibration Application
=======================================

CaliPy is a Qt-based visualization application written in Python. It displays results generated by bbo(lab)-calibcam to check camera calibration.

Installation
------------

CaliPy depends on the following Python packages:

  - NumPy
  - PyYAML
  - OpenCV
  - ImageIO with FFMPEG support
  - Construct
  - PyQt5
  - PyQtGraph
  - SciPy
  - Matplotlib
  - Bbolab/calibcamlib
  - Bbolab/svidreader
  - PyInstaller (optional, for standalone build)

Current best practise is to use conda env.
#### Conda

You can install all the required dependencies into a conda environment with the following command:

    conda env create -f environment.yml

Then run the cali.py script with `python cali.py` from the newly created environment.

Alternatively, if you have the ```pyinstaller``` package installed (i.e. via pip) you can turn CaliPy into a self-contained executable
with the following command (**this method has possibly deprecated**):

    python3 setup.py standalone

The resulting ```CaliPy``` folder inside the ```dist``` subfolder can then be packed and distributed without the need to install any dependencies.



Usage
-----
1. This is a GUI to view bbo-lab calibcam results. The software offers some commandline options:
   1. `--videos` can be used to provide paths to video files, and `--pipelines` (optional) any pipelines to be
      applied on these videos. The final output of the pipeline is used to display calibration.
   2. `--calib_file` is for loading calibration results from _bbo-calibcam_. If no video information is provided using the above
      commandline options, the software will attempt to load videos from the calib_file. In that case, make sure the video links in the
      calib_file are active.
   3. `--load_detections` and `--load_calibrations_single` allow handling of additional results generated by calibcam. Paths
      to the files can be provided with these flags. If no path is provided, the software tries to load them from the folder containing
      `calib_file`. If you wish to not load them, pass `false` as argument.

   _Note: if no proper commandline options are provided, an empty GUI is loaded._


2. In the 'Sources' dock, add a session and add recordings to the session. Multiple such sessions can be added.
3. This is a GUI to view bbo-lab calibcam results. On the _Menubar_, use `Result > Load .npy` to load calibcam calibration files.
   The loaded calibration will be assigned to the current session, and one calibration can be assigned to and displayed for each session.
4. Ideally, the software should match the already loaded videos (in the current session) to the 'rec_file_names' in the calibcam dictionary.


Format
------

Use ```File > Save..``` to save the session and the added sources as a ```.system.yml``` file. The session can be reopened by selecting it under ```File > Open..```.

Bbo-calibcam files are either ```.yml``` or ```.npy``` files containing a dictionary. Use can use ```Result > Load Calib``` to load them.
