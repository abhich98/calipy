CaliPy - Camera Calibration Application
=======================================

CaliPy is a Qt-based calibration application written in Python. It displays results generated by bbolab-Calibcam in the background to perform camera calibration.

Currently supported calibration patterns:

  - [ChAruco Boards](https://docs.opencv.org/3.4.6/da/d13/tutorial_aruco_calibration.html)

Currently supported camera models:

  - [Pinhole Camera Model](https://docs.opencv.org/3.4.6/d9/d0c/group__calib3d.html#details)
  - [Omnidirectional Camera Model](https://docs.opencv.org/3.4.6/d3/ddc/group__ccalib.html)

Installation
------------

CaliPy depends on the following Python packages:

  - NumPy and SciPy
  - PyYAML
  - OpenCV
  - ImageIO with FFMPEG support
  - Construct
  - PyQt5
  - PyQtGraph
  - Bbolab/Calibcam
  - Bbolab/Calibcamlib
  - Joblib
  - Autograd
  - PyInstaller (optional, for standalone build)

Current best practise is to use conda env.
#### Conda

You can install all the required dependencies into a conda environment with the following command:

    conda env create -f environment.yml

Then run the cali.py script with `python cali.py` from the newly created environment.

Alterntively if you have the ```pyinstaller``` package installed (i.e. via pip) you can turn CaliPy into a self-contained executable with the following command:

    python3 setup.py standalone

The resulting ```CaliPy``` folder inside the ```dist``` subfolder can then be packed and distributed without the need to install any dependencies.



Usage
-----

1. Add cameras with appropriate identifiers in the 'Cameras' dock on the top left side of the window.
2. In the 'Sources' dock, add a session and add a recording for each one of the cameras to the session. Multiple such sessions can be added.
3. This is a GUI to view bbo-lab calibcam results. On the _Menubar_, use `Result > Load .npy` to load calibcam calibration files.
4. Ideally, the software should match the already loaded videos to the rec_file_names in the calibcam dictionary.
5. The software offers some commandline options: `--file`, `--storage`, `--calibcam_file`.
   1. `--file` is for loading any calipy session files, junker-bird .yml files or calibcam result files. The video links in the calibcam result file should be active.
   2. `--storage` link to the bbo storage location which is necessarily needed for paths in junker-bird .yml files.
   3. `--calibcam_file` is for loading calibraiton results. This can be only used along with `--file` which will first add videos and later
   the calibration reults are added and displayed.


Format
------

Use ```File > Save..``` to save the session and the added sources as a ```.system.yml``` file. The session can be reopened by selecting it under ```File > Open..```.

Use ```Result > Save..``` to save the result, detections and calibrations, as a ```.result.pickle``` file. The result can be reloaded by selecting it under ```Result > Load..```.


